## Java 中什么情况会导致死锁？如何避免？
> 八股文一网打尽，更多面试题请看[程序员面试刷题神器 - 面试鸭](https://www.mianshiya.com/)

## 回答重点

这是一个非常典型的八股文，即操作系统中的经典理论，死锁的发生必须满足以下四个条件，这些条件被称为“死锁的必要条件”：

1. 互斥条件：每个资源只能被一个线程占用。
2. 占有和等待：线程在持有至少一个资源的同时，等待获取其他资源。
3. 不可抢占：线程所获得的资源在未使用完毕之前不能被其他线程抢占。
4. 循环等待：多个线程形成一种头尾相接的循环等待资源关系。

只要我们打破上述的一个条件，就能避免死锁的发生。

### **避免死锁的方法**
1. **按序申请资源**：确保所有线程在获取多个锁时，按照相同的顺序获取锁。
2. **尽量减少锁的范围**：将锁的粒度尽可能缩小，减少持有锁的时间。可以通过拆分锁或使用更细粒度的锁来实现。
3. **使用尝试锁机制**：使用 `ReentrantLock` 的 `tryLock` 方法，尝试在一段时间内获取锁，如果无法获取，则可以选择放弃或采取其他措施，避免死锁。
4. **设置超时等待时间**：为锁操作设置超时，防止线程无限期地等待锁。
5. **避免嵌套锁**：尽量避免在一个锁的代码块中再次尝试获取另一个锁。

> 八股文一网打尽，更多面试题请看[程序员面试刷题神器 - 面试鸭](https://www.mianshiya.com/)