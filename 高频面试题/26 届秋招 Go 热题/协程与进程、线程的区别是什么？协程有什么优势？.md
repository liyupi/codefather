## 协程与进程、线程的区别是什么？协程有什么优势？
> 八股文一网打尽，更多面试题请看[程序员面试刷题神器 - 面试鸭](https://www.mianshiya.com/)

## 回答重点


| 特性                | 进程                                    | 线程                                    | 协程                                    |
|---------------------|-----------------------------------------|-----------------------------------------|-----------------------------------------|
| **定义**            | 操作系统分配资源的基本单位。每个进程有独立的内存空间和资源。 | 线程是进程内的执行单元，多个线程共享进程的内存空间。 | 协程是用户级别的执行单元，由程序控制调度，轻量级线程。 |
| **内存空间**        | 每个进程拥有独立的内存空间。               | 线程共享进程的内存空间。                 | 协程共享同一线程的内存空间。            |
| **资源占用**        | 进程资源占用较高，包括独立的堆栈、内存等。   | 线程资源占用相对较低，比进程轻量。       | 协程资源占用最小，不需要独立堆栈。      |
| **创建和销毁开销**  | 创建和销毁进程的开销较大，操作系统参与。     | 创建和销毁线程的开销较小，但仍有线程管理开销。 | 协程创建和销毁的开销非常小，由程序控制。  |
| **调度方式**        | 由操作系统进行调度，使用抢占式调度。         | 由操作系统调度，线程调度是抢占式的。      | 协程调度由程序控制，使用协作式调度。    |
| **上下文切换开销**  | 进程切换需要保存和恢复大量的上下文信息，开销较大。 | 线程切换比进程切换轻量，但仍需保存和恢复上下文。 | 协程切换几乎不需要上下文切换，开销非常小。 |
| **并发性**          | 多个进程可以并发执行，适合独立任务。         | 多个线程可以并发执行，适合共享数据和资源的任务。 | 协程通常在单线程内并发执行，适合 I/O 密集型任务。 |
| **适用场景**        | 适合独立任务和高资源需求的程序。           | 适合需要共享资源和高并发的任务。         | 适合大量 I/O 密集型任务和高并发请求。    |
| **优缺点**          | 优：进程之间完全隔离，内存安全。缺：创建和销毁开销大，资源消耗高。 | 优：轻量级进程，适合多任务。缺：需同步机制，容易出现死锁。 | 优：高效的 I/O 并发，内存消耗极低。缺：不适合 CPU 密集型任务，依赖事件循环。 |


## 扩展知识

### Go语言中的协程（Goroutine）

Go语言通过 goroutine 和 channel 来简化并发编程，一个 goroutine 通常只有几 KB 的栈空间，并且会根据需求动态增长，使得数以万计的 goroutine 运行在单个系统上也是现实可行的。

仅需一个单独的操作系统线程上同时运行成千上万个 Goroutine，而不需要为每个 Goroutine 创建一个线程。这样避免了操作系统线程创建和销毁的高昂成本，同时也避免了线程上下文切换的开销。

### Go runtime 和调度器

Go 的调度器使用一种称为 `G-P-M` 模型（Goroutine-Processor-Machine）来管理 goroutine 的调度。G（Goroutine）是协程，M（Machine）是操作系统线程，P（Processor）是一个调度器的抽象，它负责把 goroutine 调度到操作系统线程上执行。

每个操作系统线程 M 都绑定一个或多个 P，P 负责将 Goroutine 调度到 M 上执行。当 Goroutine 发生 I/O 操作时，它可以主动挂起，Go 调度器会将任务切换到其他 Goroutine 上，极大地提高了并发性能。

- [1934. 什么是 Go 语言的 GPM 模型？](https://www.mianshiya.com/question/1810649501711491074)

> 八股文一网打尽，更多面试题请看[程序员面试刷题神器 - 面试鸭](https://www.mianshiya.com/)