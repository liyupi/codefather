# 多态

在计算机编程领域，多态是指不同的对象针对相同的消息会作出不同的响应，或者说是同一种行为具有不同的表现形式或状态。多态是面向对象编程语言的一个重要特性，其中 C++ 是最为广泛使用多态机制的面向对象语言。

我们都知道，面向对象是重视对象的，在程序设计中，一个对象并不是孤立存在的，它们相互之间通过消息传递进行协作，按照面向对象的设计思想，在同一个类的不同对象间，应该可以对同一消息做出不同的响应，这就是多态的基础。

在 C++ 中，实现多态有两种方式。第一种是基于继承的多态，也称为虚函数多态；第二种是基于模板的多态，也称为泛型编程。

## 基于继承的多态

基于继承的多态主要是通过虚函数机制来实现。在 C++ 中，用 virtual 关键字修饰的成员函数称为虚函数，当虚函数被定义时，编译器会为该函数建立一个虚函数表（VFT），同时在对象的内存空间中添加一个虚函数指针（VTP）指向该表。在程序运行时，通过指针访问虚函数时，把从对象中获取的 VTP 指向 VFT，再根据 VFT 中对应函数的地址，跳转到对应的函数代码上，从而实现多态。

在 C++ 中，可以通过利用基类的引用或指针，实现派生类对象的多态操作，这样就可以在编译时未知运行时对象的准确类型，但是保证能调用到正确的函数。

通过下面的代码可以更进一步了解基于继承的多态：

```c++
class Shape {
   public:
      virtual void area() = 0;
};

class Rectangle : public Shape {
   public:
      void area () {
         cout << "Rectangle area" << endl;
      }
};

class Circle : public Shape {
   public:
      void area () {
         cout << "Circle area" << endl;
      }
};

int main() {
   Shape *shape;
   Rectangle rect;
   Circle cir;

   shape = &rect;       // 派生类对象 rect 赋值给基类指针 shape
   shape->area();

   shape = &cir;        // 派生类对象 cir 赋值给基类指针 shape
   shape->area();

   return 0;
}
```

上面这个程序中，基类 Shape 包含一个纯虚函数 area()，派生类 Rectangle 和 Circle 继承 Shape，并实现自己的 area() 函数，在主函数中，定义一个基类指针，然后把派生类指针 rect 和 cir 赋给该指针，通过调用 area() 实现了多态。

## 基于模板的多态

基于模板的多态主要是通过模板函数和模板类的特化机制来实现。在 C++ 中，通过使用 template 关键字，可以定义泛型函数和泛型类，其中泛型类型可以根据实参的类型而随意变化，使函数和类具有了更广泛的适用性，在有需要的情况下，可以使用模板类和模板函数来提高代码的复用性和效率，达到多态的效果。

通过下面的代码可以更进一步了解基于模板的多态：

```c++
template<typename T>
void swap(T& x, T& y) {
   T temp = x;
   x = y;
   y = temp;
}

int main() {
   int a = 1, b = 2;
   double c = 1.1, d = 2.2;

   swap(a, b);
   swap(c, d);

   return 0;
}
```

上面这个程序中，定义了一个模板函数 swap()，可以交换任意类型的变量及其内部成员的值。在主函数中，通过使用 swap()，实现了对 int 和 double 类型变量的交换。这就是基于模板的多态实现方式。

## 总结

多态是面向对象编程语言中非常重要的特性，在 C++ 中，多态是实现代码复用和灵活性的一种重要手段。基于继承的多态是最广泛使用的一种实现方式，而基于模板的多态则可以提高代码复用性和效率，适合处理各种数据类型。