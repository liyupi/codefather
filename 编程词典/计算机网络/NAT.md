# NAT

在网络编程中，经常会遇到 NAT 的概念。NAT 全称为 Network Address Translation，即网络地址转换。在介绍 NAT 的概念之前，需要了解一个问题：IPv4 中有 4 个字节（32 位）的 IP 地址，这样就可以分配的地址总数达到 2 的 32 次方，约为 42 亿个，然而这个数字却远远不够用。我们知道，当一个设备连接到互联网时，需要获取一个独立的 IP 地址，而 IPv4 的地址总数的瓶颈就导致了不可能给每台连接到互联网上的设备都分配一个独立的 IP 地址。因此，NAT 出现了。

NAT 可以将一个网段的整体 IP 地址映射到另一个网段，可以将内部局域网的主机与全球互联网连接起来。NAT 主要有两个功能：  
1. 统一内部网络。由于在一个内网中可能会有数百台机器，为了防止 IP 段冲突，需要 NAT 设备作为网关向 Internet 提供服务的情况下，所有内网用户只需要使用单个公网 IP 地址。  
2. 隐藏内部网络。因为内网被 NAT 设备所维护，内部网络无法直接访问 Internet，所有与外部服务的交互都需要通过 NAT 设备代为完成，实现了对内网主机的隔离，建立了对于非法入侵的一定程度上的防护。

NAT 分为静态 NAT 和动态 NAT。静态 NAT 是将内部网络中一个固定的地址映射到 Internet 上的一个固定的地址，而动态 NAT 则解决了静态 NAT 无法解决的地址不足的问题，它不仅可以将内部网络中的地址映射到 Internet 上，还可以对 IP 地址进行动态分配。

总的来说，NAT 对于公网资源的分配作用是巨大的，但是 NAT 也有一些缺点，主要表现在状态维护成本高和无法支持部分协议上。