# 后向渲染

后向渲染(Deferred Rendering)，又称G缓存渲染(GBufffer Rendering)，在当前游戏开发的领域中被广泛应用。与传统的前向渲染(Forward Rendering)相比，后向渲染具有诸多优势。

## 原理

后向渲染利用颜色缓冲器和深度缓冲器存储场景信息，先建立一个几何空间，将场景中各个物体的位置信息和表面特性存储在几何空间中的不同纹理层，例如颜色、法线、金属度、粗糙度等。接着一种叫做 ‘deferred shading’ 的方法，利用每个像素点的位置参数从几何空间中提取出相应的材质参数，并利用光照方程对其进行计算。这样可以大大节约资源，提高渲染效率。

## 优点

后向渲染相较于前向渲染，可以解决传统渲染方式中的一些难点。例如：

- 影响多次采样：前向渲染每个像素点只记录了这个点被最后一个像素覆盖之后的颜色信息，因此在多次采样或者半透明物体的情况下会导致错误的计算。后向渲染则记录了每个像素点的颜色、法线、深度等信息，计算时不再需要进行多次采样，因此能够提升渲染的效率。

- 光影计算复杂：传统前向渲染中出现了一些需要消耗巨大性能的计算，比如阴影，多点光源叠加等。这些在复杂的场景中会极容易造成 GPU 瓶颈，时刻拸住渲染效率。后向渲染利用了已经存贮在 GBuffer 缓存中的信息，使用更少的指令来实现光影计算。

- 可编程流水线支持：后向渲染使用了可编程流水线，因此支持更多的自定义渲染特性，比如纯色渲染，鲜明排版和更多的改进和实现。这让任何人都可以扩展渲染管线来支持他们的独特特性，从而使得渲染管线更加灵活、扩展性极高。

## 缺点

但是后向渲染也有一些缺点：

- 标准的后向渲染不能支持抗锯齿(Anti-Aliasing)，因为需要将屏幕像素转换为几何空间的坐标，而这会导致Aliasing现象。

- 透明度处理不如前向渲染：后向渲染在处理半透明物体时存在一些问题，尤其是物体的边缘效果。使用前向渲染可以很好地处理这些问题。

总体来说，后向渲染是在传统前向渲染的基础上进行了许多的优化。虽然还存在一些问题和不足，但逐渐被越来越多的游戏所采用。当然，具体使用哪种方式还要根据实际项目的需要来判断。