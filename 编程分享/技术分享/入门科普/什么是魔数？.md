# 什么是魔数？

> 本文作者：[程序员鱼皮](https://yuyuanweb.feishu.cn/wiki/Abldw5WkjidySxkKxU2cQdAtnah)
>
> 本站地址：[https://codefather.cn](https://codefather.cn)

大家好，我是鱼皮，无意间在网上看到了这么一张图：

![](https://pic.yupi.icu/5563/202311071357358.png)

刚看到这段代码时，我是比较吃惊的，作者竟然使用了一个英文单词 `deadbeef` 来定义宏常量！

我本来以为只是一位幽默的程序员的小玩笑，但后来查阅资料才知道，上图的这段代码竟是 C++ 的 hash_map 源码！而作者使用这个特殊的英文单词也是 “别有用心”。

deadbeef  的英文直译是死牛肉，但在编程领域中，它却有更深层的含义。给这个单词加上 `0x` 、再转换为大写，就得到了一个典型的十六进制数字：0xDEADBEEF。这个数字经常用来标识新分配但是还未初始化的内存；在嵌入式系统中，也常常用它来表示程序崩溃或者出现了死锁，比如运行在 32 位 PowerPC 处理器上的 IBM RS/6000 系统、Mac OS 系统。

那我不禁感到好奇，为什么选择了这样一个单词，而不是 “FishPi” 之类的（开个玩笑，16 进制最多到 F）。

![](https://pic.yupi.icu/5563/202311071357076.png)

到网上查了一会，得到的结论竟然是：没什么理由，它是一个 **“魔数”**！

所谓魔数，就是毫无理由、凭空出现、也不需要去解释其含义的常量。就是这么任性！

除了 deadbeef 外，我还百度到了很多魔数，比如：

- 0xBAADF00D ("bad food" 烂饭) 被微软的 LocalAlloc（LMEM_FIXED）使用，在使用调试堆时指示未初始化的已分配堆内存
- 0xDEADC0DE ("dead code" 死码) 在 OpenWRT 固件中用作标记，在静态固件的末尾表示要创建的 jffs2 文件系统的开始
- 0xDEAD10CC ("dead lock" 死锁)  用于表示 iOS 系统的闪退报告

是不是感觉很神奇？也许这就是程序员的浪漫吧。

看到这里，我忍不住了，也去写了几个魔数，大家来猜猜看是什么意思：

```
redisLock.lease(86400);
if (fileSize > 1073741824) {
  ...doSomething
}
if (num > 2147483647) {
  printf("you lose");
}
```

这几个值都是我们写代码时经常用的，84600 = 3600 * 24 表示一天；1073741824 = 1024 * 1024 * 1024 表示 1 GB；而 2147483647 是 Java 等编程语言中 int 类型的最大值。

![](https://pic.yupi.icu/5563/202311071357226.png)

我把这些代码拿给我朋友一看，他嘲笑道：人家大佬写的魔数叫魔数，而你写的，只能叫烂代码。

![](https://pic.yupi.icu/5563/202311071357499.png)

的确，除非是上面那些大佬 / 前辈公认的、约定俗成的魔数外，我们在平时写代码的时候，尽量不要使用魔数，它会严重影响代码的可读性。我们可以通过定义常量来给这些魔数加上 “注释”，比如：

```
int ONE_DAY = 86400;
int ONE_GB = 1073741824;
int MAX_INTEGER = 2147483647;
```

这样就清晰很多了，也减少了我们输入错误的风险。

除了上面提到的魔数外，我还在网上看到了一些有实际意义的魔数，比如现代 3D 游戏之父约翰·卡马克在雷神之锤中的魔数：

```
i = 0x5f3759df - ( i >> 1 );
```

完全不敢相信，上面这行代码竟然可以快速计算一个数字的平方根的倒数！

在网上一查，还有很多论文专门研究这个东西：

![](https://pic.yupi.icu/5563/202311071357398.png)

不得不感叹编程的魅力、数学的魅力啊！什么时候，我也能创造一个人尽皆知的魔数呢？

同事：“喂，鱼皮，别特么做梦了，来搬砖！”

“来了来了，我再给你写几个魔数（烂代码）！”

![](https://pic.yupi.icu/5563/202311071357242.png)



------


点击加入鱼皮的 [编程学习圈子](https://yuyuanweb.feishu.cn/wiki/VC1qwmX9diCBK3kidyec74vFnde) ，和 **3000 多名** 小伙伴们一起交流学习编程，跟着鱼皮直播做项目，享受免费简历修改、1 对 1 答疑等服务。